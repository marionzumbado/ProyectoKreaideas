<%= javascript_include_tag :defaults %>
<script type="text/javascript">
    $(document).ready(function(){
        $("select#category_category_id").change(function(){
            var id_value_string = $(this).val();
            if (id_value_string == "") {
                // if the id is empty remove all the sub_selection options from being selectable and do not do any ajax
                $("select#product_subcategory_id").remove();
                var row = "<option value=\"" + "" + "\">" + "" + "</option>";
                $(row).appendTo("product_subcategory_id");
            }
            else {
                // Send the request and update sub category dropdown
                $.ajax({
                    dataType: "json",
                    cache: false,
                    url: '/subcategories/search_by_category/'+id_value_string+'.json' ,
                    data:  id_value_string,
                    timeout: 2000,
                    error: function(XMLHttpRequest, errorTextStatus, error){
                        alert("Failed to submit : "+ errorTextStatus+" ;"+error);
                    },
                    success: function(data){                    
                        // Clear all options from sub category select
                        $("select#product_subcategory_id option").remove();
                        //put in a empty default line
                        //var row = "<option value=\"" + "holA" + "\">" + "" + "</option>";
                        //$(row).appendTo("select#subcategory_subcategory_id");                        
                        // Fill sub category select
                        $.each(data, function(i, subcategory){
                             row = "<option value=\"" + subcategory.id + "\">" + subcategory.name + "</option>";  
                            $(row).appendTo("select#product_subcategory_id");                    
                        });            
                     }
                });
            };
                });
    });
</script>

<script type="text/javascript">
//script pata agregar mas campos para mas achivos
var filecounter = 1;
function add_file()  
{ 
  filecounter++;
  var br = document.createElement('br');  //para los saltos necesarios
  br.className='object'+filecounter;
  //nuevo campos a insertar la clase es para cuando eliminemos
  var inputfile = document.createElement('input');  
  inputfile.id="inputfile"+ filecounter;
  //inputfile.class="object"+ filecounter;
  inputfile.type="file";
  inputfile.className='object'+ filecounter;
  //agrega en el div files
  document.getElementById('files').appendChild(inputfile);
  //agregamos el boton de eliminar el archivo
  var inputbutton = document.createElement('input');
  inputbutton.id="inputbutton"+filecounter;
  //inputbutton.class="object"+filecounter;
  inputbutton.type="button";
  inputbutton.className='object'+filecounter;
  inputbutton.value="Eliminar";
  //accion de eliminar del boton, borra toda la clase a la que pertenece el boton
  inputbutton.onclick= function(){
    alert(this.className);
    $('.'+this.className).remove();
  };
  document.getElementById('files').appendChild(inputbutton);
  document.getElementById('files').appendChild(br);
  //borramos addfiltext para agregarlo luego al final
  $("#addfiletext").remove();
  //lo agregamos al final
   var addfilenew = document.createElement('a');
   addfilenew.id="addfiletext";
   addfilenew.href="javascript:add_file()";
   addfilenew.text="Agregar imagen" + filecounter;
   document.getElementById('files').appendChild(addfilenew);

   
  }
</script>



















<%= form_for [refinery, :products_admin, @product], html: { multipart: true } do |f| -%>
  <%= render '/refinery/admin/error_messages',  :object => @product,  :include_object_name => true %>


  <div class='field'>  
  <p>
    <label>Archivo<label/>
    <%= f.file_field :attach%>
  </p>

  <div class='field'>
    <%= f.label :code -%>
    <%= f.text_field :code -%>
  </div>
  <div class='field'>
    <%= f.label :name -%>
    <%= f.text_field :name -%>
  </div>

  <div class='field'>
    <%= f.label :description -%>
    <%= f.text_field :description -%>
  </div>

  <div class='field'>
    <%= f.label :price -%>
    <%= f.text_field :price -%>
  </div>

  <div class='field'>
    <%= f.label :author -%>
    <%= f.text_field :author -%>
  </div>
  <div class='field'>
    <%= f.label :exchange -%>
    <%= f.number_field :exchange -%>
  </div>
  <div class='field'>
    <%= f.label :bonus -%>
    <%= f.number_field :bonus -%>
  </div>
  <div>   
    <label>Categorias  </label>
    <%= collection_select(:category, :category_id,@categories,:id, :name)-%>
  </div>
  <div>
    <label>Subcategorias  </label>
    <%= f.collection_select :subcategory_id, @subcategories, :id, :name %>
  </div>
  <div id="files">
    <% number = 0 %>
  <%= f.fields_for :images do |asset| %>
        <%= asset.label "File ##{number +=1}" %>
        <%= asset.file_field :asset %>
  <% end %>
</br>
    <a class='object1' id="addfiletext" href="javascript:add_file()">Agregar imagen </a>   
  </div>




<%= render '/refinery/admin/form_actions', :f => f,
             :continue_editing => false,
             :delete_title => t('delete', :scope => 'refinery.products.admin.products.product'),
             :delete_confirmation => t('message', :scope => 'refinery.admin.delete', :title => @product.name) -%>
<% end -%>










    
